runs-on: ubuntu-latest

steps:
  - name: â¬‡Checkout Repository
    uses: actions/checkout@v4

  # Log in using the built-in GITHUB_TOKEN, which automatically has 
  # push permission when the 'packages: write' permission is set above.
  - name: ğŸ³ Log in to GitHub Container Registry (ghcr.io)
    uses: docker/login-action@v3
    with:
      registry: ghcr.io
      username: ${{ github.actor }}
      password: ${{ secrets.GITHUB_TOKEN }}

  - name: âš™ï¸ Set up Docker Buildx (Required for advanced build features and multi-platform support)
    uses: docker/setup-buildx-action@v3
  
  # --- Build and Push Frontend ---
  - name: ğŸ—ï¸ Build and Push Frontend Image
    uses: docker/build-push-action@v5
    with:
      # Context: The directory containing all files needed for the build (e.g., source code).
      context: ./frontend
      # File: The path to the Dockerfile relative to the context. 
      # Since context is ./frontend, the Dockerfile is at ./frontend/Dockerfile
      file: ./frontend/Dockerfile 
      push: true
      tags: ghcr.io/${{ github.repository }}/frontend:latest
  
  # --- Build and Push Backend ---
  - name: ğŸ—ï¸ Build and Push Backend Image
    uses: docker/build-push-action@v5
    with:
      context: ./backend
      file: ./backend/Dockerfile
      push: true
      tags: ghcr.io/${{ github.repository }}/backend:latest
      
  # --- Build and Push Nginx (Reverse Proxy) ---
  - name: ğŸ—ï¸ Build and Push Nginx Image
    uses: docker/build-push-action@v5
    with:
      # Context: Use the root of the repository to ensure all needed files/configs (e.g., from the 'nginx' folder) are available.
      context: . 
      # File: Path to the Dockerfile relative to the root context.
      file: ./nginx/Dockerfile 
      push: true
      tags: ghcr.io/${{ github.repository }}/nginx:latest
